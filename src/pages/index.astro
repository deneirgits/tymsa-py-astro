---
import Layout from "../layouts/Layout.astro";
import CurrentTimer from "../components/CurrentTimer.svelte";

import { GET as getTimer } from "./api/timer/current";
import { GET as refreshToken } from "../pages/api/auth/refresh";
import { GET as getTimersList } from "./api/timer/list";
import TimersList from "../components/TimersList.svelte";

if (Astro.cookies.get("accessToken") === undefined) {
  return refreshToken(Astro);
}

let response = await getTimer(Astro);
const timerData = await response.json();

response = await getTimersList(Astro);
const timersListData = await response.json();
---

<Layout title="Home">
  <CurrentTimer client:load timer={timerData.timer} />
  <TimersList client:visible timers={timersListData.timers} />
</Layout>
